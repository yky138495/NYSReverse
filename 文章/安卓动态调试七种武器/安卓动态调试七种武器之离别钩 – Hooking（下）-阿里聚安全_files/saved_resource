KISSY.add("aq/community/community",function(t,i){function e(t){for(var i="",e=0;e<t.length;e++)i+=["<li>",'<h3><a href="'+t[e].url+'">'+t[e].title+"</a></h3>",'<p class="article-time">','<i class="jaqicons icon-uea09calendar"></i>',t[e].updatetime,'<i class="jaqicons icon-uea07eye"></i>',t[e].hits,"</p>",'<p class="article-desc">',t[e].description,"</p>","</li>"].join("");return i}function a(){c("#J-tag-header").delegate("click","li",function(t){var i=c(t.currentTarget);i.siblings(".current").removeClass("current"),i.addClass("current"),c("#"+i.attr("data-id")).show().siblings().hide()}),c("#closeFloat").on("click",function(t){var i=c(this).parent();i.animate({opacity:0},.5,"easing",function(){i.hide()})})}function n(){var t=c(".article-list"),a=c("#next-page"),n=c("#loading-gif"),r=10,o=!1,s=!1;a.on("click",function(c){o||(n.show(),a.hide(),new i({url:"/community/api/article",dataType:"json",type:"get",data:{catid:t.attr("data-catid"),start:r,num:5},success:function(i){if(s=!1,n.hide(),a.show(),i.res){if(0==i.articlelist.length)return o=!0,void a.css("cursor","default").text("已到最后一页了");t.append(e(i.articlelist)),r=i.start}},error:function(){}}))})}function r(){var t=c(".article-list"),a=window.innerHeight,n=5,r=!1,o=!1,s=null;c(window).on("scroll",function(c){var l=t.last(),u=document.body.scrollTop,d=l.offset().top+l[0].offsetHeight;!o&&!r&&a>d-u&&(s&&clearTimeout(s),s=setTimeout(function(){o=!0,new i({url:"/community/api/article",dataType:"json",type:"get",data:{catid:t.attr("data-catid"),start:n,num:3},success:function(i){if(o=!1,i.res){if(0==i.articlelist.length)return void(r=!0);t.append(e(i.articlelist)),n=i.start}},error:function(){}})},100))})}var c=t.all;return{bindTabEvent:a,bindScrollEvent:r,bindNextPageEvent:n}},{requires:["ajax"]});